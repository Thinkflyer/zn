<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="js/config.js"></script>
		<style>
			html,
			body,
			.mui-content {
				background-color: #ffffff;
			}
			
			.mui-icon {
				color: #ffffff
			}
			
			.mui-input-row .mui-btn {
				width: 45%;
				margin-right: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">找回密码</h1>
			<button class="mui-btn mui-btn-link mui-btn-nav mui-pull-left">
				<div class="kele mui-action-back mui-icon-back">返回</div>
			</button>
		</header>
		<div class="mui-content">

			<div class="mui-input-row">
				<h1 class="htitle">找回密码</h1>
				<input id='account' type="text" class="mui-input" placeholder="请输入您的E-mail">
			</div>

			<div class="mui-input-row s_left">
				<button class="btn-color mui-btn">取 消</button>
				<button class="btn-color mui-btn">提 交</button>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				$.init();
				$.plusReady(function() {
					plus.nativeUI.closeWaiting();
					plus.webview.currentWebview().show();
					//提交
					doc.getElementById('submit_do').addEventListener('tap', function(event) {
						var account = doc.getElementById('account');
						var auth = doc.getElementById('auth');
						var _mobile = account.value;
						if (!_mobile) {
							plus.nativeUI.toast('手机号码不能为空');
							return;
						} else {
							var mflag = regBox.regMobile.test(_mobile);
							if (!(mflag)) {
								plus.nativeUI.toast("手机号码有误！");
								return false;
							}
						}
						if (auth.value == "") {
							plus.nativeUI.toast("验证码不为空");
						}
						//提交 
						$.ajax({
							type: 'POST',
							dataType: 'json',
							url: baseDomain + "index.php?g=Api&m=Index&a=verify_pwd",
							timeout: 5000, //超时时间设置为10秒；
							data: {
								mobile: account.value,
								m_code: auth.value,
							},
							success: function(msg) {
								if (msg.code == 0) {
									plus.nativeUI.toast(msg.info);
								} else {
									//成功 跳转至重置密码
									$.openWindow({
										url: 'repassword.html',
										id: 'repassword',
										show: {
											aniShow: 'pop-in'
										},
										extras: {
											mobile: account.value
										},
										styles: {
											popGesture: 'hide'
										},
										waiting: {
											autoShow: false
										}
									});
								}
							}
						});
					}, false);
					//提交获取短信
					doc.getElementById('get_auth').addEventListener('tap', function(event) {
						var _mobile = doc.getElementById('account').value;
						if (!_mobile) {
							plus.nativeUI.toast('手机号码不能为空');
							return;
						} else {
							var mflag = regBox.regMobile.test(_mobile);
							if (!(mflag)) {
								plus.nativeUI.toast("手机号码输入格式错误");
								return false;
							}
						}
						timer(30);
						//提交获取短信
						$.ajax({
							type: 'POST',
							dataType: 'json',
							url: baseDomain + "index.php?g=Api&m=Index&a=getauth",
							data: {
								mobile: _mobile
							},
							success: function(msg) {
								if (msg.code == 0) {
									plus.nativeUI.toast(msg.info);
								} else {
									plus.nativeUI.toast(msg.info);
								}
							},
							error: function(xhr, type, errorThrown) {
								//异常处理
								plus.nativeUI.toast(mylang.error_network);
							}
						});
					}, false);
				});
			}(mui, document));

			function timer(time) {
				var btn = Zepto('#get_auth');
				btn.attr("disabled", true); //按钮禁止点击
				btn.html(time <= 0 ? "发送动态密码" : ((time) + "秒后可发送"));
				var hander = setInterval(function() {
					if (time <= 0) {
						clearInterval(hander); //清除倒计时
						btn.html("获取验证码");
						btn.removeAttr("disabled");
						return false;
					} else {
						btn.html((time--) + "秒后可发送");
					}
				}, 1000);
			}
		</script>
	</body>

</html>